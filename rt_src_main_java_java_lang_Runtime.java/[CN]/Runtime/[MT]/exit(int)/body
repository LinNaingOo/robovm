{
  SecurityManager smgr=System.getSecurityManager();
  if (smgr != null) {
    smgr.checkExit(code);
  }
synchronized (this) {
    if (!shuttingDown) {
      shuttingDown=true;
      Thread[] hooks;
synchronized (shutdownHooks) {
        hooks=new Thread[shutdownHooks.size()];
        shutdownHooks.toArray(hooks);
      }
      for (int i=0; i < hooks.length; i++) {
        hooks[i].start();
      }
      for (      Thread hook : hooks) {
        try {
          hook.join();
        }
 catch (        InterruptedException ex) {
        }
      }
      if (finalizeOnExit) {
        runFinalization(true);
      }
      nativeExit(code,true);
    }
  }
}
