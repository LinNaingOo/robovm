{
  if (hook == null) {
    throw new NullPointerException("Hook may not be null.");
  }
  if (shuttingDown) {
    throw new IllegalStateException("VM already shutting down");
  }
  SecurityManager sm=System.getSecurityManager();
  if (sm != null) {
    sm.checkPermission(new RuntimePermission("shutdownHooks"));
  }
synchronized (shutdownHooks) {
    return shutdownHooks.remove(hook);
  }
}
