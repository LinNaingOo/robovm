{
  if (usingSocks()) {
    ((PlainSocketImpl)newImpl).socksBind();
    ((PlainSocketImpl)newImpl).socksAccept();
    return;
  }
  try {
    int timeout=(Integer)getOption(SO_RCVTIMEO);
    if (timeout > 0) {
      StructPollfd pfd=new StructPollfd();
      pfd.fd=fd;
      pfd.events=(short)(POLLIN | POLLERR);
      StructPollfd[] pfds=new StructPollfd[]{pfd};
      while (true) {
        long start=System.currentTimeMillis();
        try {
          if (timeout <= 0 || Libcore.os.poll(pfds,timeout) == 0) {
            throw new SocketTimeoutException("accept() timed out");
          }
        }
 catch (        ErrnoException e) {
          if (e.errno == EINTR) {
            long duration=System.currentTimeMillis() - start;
            timeout-=duration;
          }
 else {
            throw e;
          }
        }
      }
    }
    InetSocketAddress peerAddress=new InetSocketAddress();
    FileDescriptor clientFd=Libcore.os.accept(fd,peerAddress);
    newImpl.fd.setInt$(clientFd.getInt$());
    newImpl.address=peerAddress.getAddress();
    newImpl.port=peerAddress.getPort();
  }
 catch (  ErrnoException errnoException) {
    if (errnoException.errno == EAGAIN || errnoException.errno == EWOULDBLOCK) {
      throw new SocketTimeoutException(errnoException);
    }
    throw errnoException.rethrowAsSocketException();
  }
  newImpl.setOption(SocketOptions.SO_TIMEOUT,Integer.valueOf(0));
  newImpl.localport=IoBridge.getSocketLocalPort(newImpl.fd);
}
