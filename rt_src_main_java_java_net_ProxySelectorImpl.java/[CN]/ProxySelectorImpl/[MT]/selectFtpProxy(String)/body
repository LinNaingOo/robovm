{
  String host;
  String port=null;
  Proxy.Type type=Proxy.Type.DIRECT;
  String nonProxyHosts=getSystemProperty("ftp.nonProxyHosts");
  if (isNonProxyHost(uriHost,nonProxyHosts)) {
    return Proxy.NO_PROXY;
  }
  host=getSystemProperty("ftp.proxyHost");
  if (null != host) {
    type=Proxy.Type.HTTP;
    port=getSystemProperty("ftp.proxyPort",String.valueOf(FTP_PROXY_PORT));
  }
 else {
    host=getSystemProperty("socksProxyHost");
    if (null != host) {
      type=Proxy.Type.SOCKS;
      port=getSystemProperty("socksProxyPort",String.valueOf(SOCKS_PROXY_PORT));
    }
  }
  int defaultPort=(type == Proxy.Type.SOCKS) ? SOCKS_PROXY_PORT : FTP_PROXY_PORT;
  return createProxy(type,host,port,defaultPort);
}
