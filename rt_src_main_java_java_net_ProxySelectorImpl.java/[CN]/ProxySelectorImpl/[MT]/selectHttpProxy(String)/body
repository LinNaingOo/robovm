{
  String host;
  String port=null;
  Proxy.Type type=Proxy.Type.DIRECT;
  String nonProxyHosts=getSystemProperty("http.nonProxyHosts");
  if (isNonProxyHost(uriHost,nonProxyHosts)) {
    return Proxy.NO_PROXY;
  }
  host=getSystemProperty("http.proxyHost");
  if (null != host) {
    type=Proxy.Type.HTTP;
    port=getSystemPropertyOrAlternative("http.proxyPort","proxyPort",String.valueOf(HTTP_PROXY_PORT));
  }
 else   if ((host=getSystemProperty("proxyHost",null)) != null) {
    type=Proxy.Type.HTTP;
    port=getSystemPropertyOrAlternative("proxyPort","http.proxyPort",String.valueOf(HTTP_PROXY_PORT));
  }
 else   if ((host=getSystemProperty("socksProxyHost")) != null) {
    type=Proxy.Type.SOCKS;
    port=getSystemProperty("socksProxyPort",String.valueOf(SOCKS_PROXY_PORT));
  }
  int defaultPort=(type == Proxy.Type.SOCKS) ? SOCKS_PROXY_PORT : HTTP_PROXY_PORT;
  return createProxy(type,host,port,defaultPort);
}
