{
  MockResponse response=new MockResponse();
  transferKind.setBody(response,"ABCDE\nFGHIJKLMNOPQRSTUVWXYZ",1024);
  server.enqueue(response);
  server.enqueue(new MockResponse().setBody("Request #2"));
  server.play();
  URLConnection connection=server.getUrl("/").openConnection();
  InputStream in=connection.getInputStream();
  assertEquals("ABCDE",readAscii(connection,5));
  in.close();
  try {
    in.read();
    fail("Expected an IOException because the stream is closed.");
  }
 catch (  IOException expected) {
  }
  assertEquals(1,cache.getWriteAbortCount());
  assertEquals(0,cache.getWriteSuccessCount());
  connection=server.getUrl("/").openConnection();
  assertEquals("Request #2",readAscii(connection));
  assertEquals(1,cache.getWriteAbortCount());
  assertEquals(1,cache.getWriteSuccessCount());
}
