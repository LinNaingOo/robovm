{
  if (debug)   dPrint("find factoryId =" + factoryId);
  try {
    String systemProp=SecuritySupport.getSystemProperty(factoryId);
    if (systemProp != null && systemProp.length() > 0) {
      if (debug)       dPrint("found system property, value=" + systemProp);
      return newInstance(systemProp,classLoader,true);
    }
  }
 catch (  SecurityException se) {
  }
  try {
    String javah=SecuritySupport.getSystemProperty("java.home");
    String configFile=javah + File.separator + "lib"+ File.separator+ "stax.properties";
    String factoryClassName=null;
    if (firstTime) {
synchronized (cacheProps) {
        if (firstTime) {
          File f=new File(configFile);
          firstTime=false;
          if (SecuritySupport.doesFileExist(f)) {
            if (debug)             dPrint("Read properties file " + f);
            cacheProps.load(SecuritySupport.getFileInputStream(f));
          }
        }
      }
    }
    factoryClassName=cacheProps.getProperty(factoryId);
    if (factoryClassName != null) {
      if (debug)       dPrint("found in $java.home/stax.properties, value=" + factoryClassName);
      return newInstance(factoryClassName,classLoader,true);
    }
  }
 catch (  Exception ex) {
    if (debug)     ex.printStackTrace();
  }
  Object provider=findJarServiceProvider(factoryId);
  if (provider != null) {
    return provider;
  }
  if (fallbackClassName == null) {
    throw new ConfigurationError("Provider for " + factoryId + " cannot be found",null);
  }
  if (debug)   dPrint("loaded from fallback value: " + fallbackClassName);
  return newInstance(fallbackClassName,classLoader,true);
}
