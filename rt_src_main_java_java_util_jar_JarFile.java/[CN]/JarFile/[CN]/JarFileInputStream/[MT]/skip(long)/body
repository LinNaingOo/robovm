{
  long cnt=0, rem=0;
  byte[] buf=new byte[(int)Math.min(nbytes,2048L)];
  while (cnt < nbytes) {
    int x=read(buf,0,(rem=nbytes - cnt) > buf.length ? buf.length : (int)rem);
    if (x == -1) {
      return cnt;
    }
    cnt+=x;
  }
  return cnt;
}
