{
synchronized (lock) {
    if (encoder == null) {
      throw new IOException(Messages.getString("nio.07"));
    }
    CoderResult result=encoder.encode(chars,bytes,true);
    while (true) {
      if (result.isError()) {
        throw new IOException(result.toString());
      }
 else       if (result.isOverflow()) {
        flushOutputStreamWriter(out,bytes,encoder,lock);
        result=encoder.encode(chars,bytes,true);
        continue;
      }
      break;
    }
  }
}
