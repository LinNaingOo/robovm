{
synchronized (lock) {
    if (encoder == null) {
      throw new IOException(Messages.getString("nio.07"));
    }
    int position;
    if ((position=bytes.position()) > 0) {
      bytes.flip();
      out.write(bytes.array(),0,position);
      bytes.clear();
    }
    out.flush();
  }
}
