{
  ExecutorService executor=Executors.newSingleThreadExecutor();
  final PipedOutputStream pout=new PipedOutputStream();
  PipedInputStream pin=new PipedInputStream(pout);
  executor.submit(new Callable<Void>(){
    public Void call() throws Exception {
      OutputStream out=new DeflaterOutputStream(pout,flushing);
      out.write(1);
      out.write(2);
      out.write(3);
      out.flush();
      return null;
    }
  }
).get();
  executor.shutdown();
  return new InflaterInputStream(pin);
}
