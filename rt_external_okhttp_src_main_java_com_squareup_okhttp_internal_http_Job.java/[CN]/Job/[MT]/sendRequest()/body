{
  for (int i=0; i < request.headerCount(); i++) {
    connection.addRequestProperty(request.headerName(i),request.headerValue(i));
  }
  Request.Body body=request.body();
  if (body != null) {
    connection.setDoOutput(true);
    long contentLength=body.contentLength();
    if (contentLength == -1 || contentLength > Integer.MAX_VALUE) {
      connection.setChunkedStreamingMode(0);
    }
 else {
      connection.setFixedLengthStreamingMode((int)contentLength);
    }
    body.writeTo(connection.getOutputStream());
  }
  return connection;
}
