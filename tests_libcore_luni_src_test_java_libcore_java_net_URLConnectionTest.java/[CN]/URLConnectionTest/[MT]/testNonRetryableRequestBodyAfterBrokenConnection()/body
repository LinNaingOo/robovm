{
  server.enqueue(new MockResponse().setBody("abc").setSocketPolicy(DISCONNECT_AT_END));
  server.enqueue(new MockResponse().setBody("def"));
  server.play();
  assertContent("abc",server.getUrl("/a").openConnection());
  HttpURLConnection connection=(HttpURLConnection)server.getUrl("/b").openConnection();
  connection.setDoOutput(true);
  connection.setFixedLengthStreamingMode(3);
  OutputStream out=connection.getOutputStream();
  out.write(new byte[]{1,2,3});
  out.close();
  try {
    connection.getInputStream();
    fail();
  }
 catch (  IOException expected) {
  }
}
