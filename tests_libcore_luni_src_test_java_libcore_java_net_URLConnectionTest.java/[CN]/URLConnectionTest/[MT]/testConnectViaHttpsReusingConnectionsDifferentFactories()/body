{
  TestSSLContext testSSLContext=TestSSLContext.create();
  server.useHttps(testSSLContext.serverContext.getSocketFactory(),false);
  server.enqueue(new MockResponse().setBody("this response comes via HTTPS"));
  server.enqueue(new MockResponse().setBody("another response via HTTPS"));
  server.play();
  HttpsURLConnection connection=(HttpsURLConnection)server.getUrl("/").openConnection();
  connection.setSSLSocketFactory(testSSLContext.clientContext.getSocketFactory());
  assertContent("this response comes via HTTPS",connection);
  connection=(HttpsURLConnection)server.getUrl("/").openConnection();
  try {
    readAscii(connection.getInputStream(),Integer.MAX_VALUE);
    fail("without an SSL socket factory, the connection should fail");
  }
 catch (  SSLException expected) {
  }
}
