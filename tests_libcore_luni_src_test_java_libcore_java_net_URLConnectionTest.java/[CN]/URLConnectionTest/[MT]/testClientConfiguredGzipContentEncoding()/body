{
  byte[] bodyBytes=gzip("ABCDEFGHIJKLMNOPQRSTUVWXYZ".getBytes("UTF-8"));
  server.enqueue(new MockResponse().setBody(bodyBytes).addHeader("Content-Encoding: gzip").addHeader("Content-Length: " + bodyBytes.length));
  server.play();
  URLConnection connection=server.getUrl("/").openConnection();
  connection.addRequestProperty("Accept-Encoding","gzip");
  InputStream gunzippedIn=new GZIPInputStream(connection.getInputStream());
  assertEquals("ABCDEFGHIJKLMNOPQRSTUVWXYZ",readAscii(gunzippedIn,Integer.MAX_VALUE));
  assertEquals(bodyBytes.length,connection.getContentLength());
  RecordedRequest request=server.takeRequest();
  assertContains(request.getHeaders(),"Accept-Encoding: gzip");
}
