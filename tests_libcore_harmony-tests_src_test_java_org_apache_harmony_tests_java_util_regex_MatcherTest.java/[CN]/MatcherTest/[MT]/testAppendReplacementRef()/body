{
  Pattern p=Pattern.compile("xx (rur|\\$)");
  Matcher m=p.matcher("xx $ equals to xx rur.");
  StringBuffer sb=new StringBuffer();
  for (int i=1; m.find(); i*=30) {
    String rep=new Integer(i).toString() + " $1";
    m.appendReplacement(sb,rep);
  }
  m.appendTail(sb);
  assertEquals("1 $ equals to 30 rur.",sb.toString());
}
