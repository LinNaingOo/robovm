{
  if (isReadOnly()) {
    throw new SecurityException(Messages.getString("security.15"));
  }
  if (permission == null) {
    throw new NullPointerException(Messages.getString("security.20"));
  }
  Class klass=permission.getClass();
  PermissionCollection klassMates=(PermissionCollection)klasses.get(klass);
  if (klassMates == null) {
synchronized (klasses) {
      klassMates=(PermissionCollection)klasses.get(klass);
      if (klassMates == null) {
        klassMates=permission.newPermissionCollection();
        if (klassMates == null) {
          klassMates=new PermissionsHash();
        }
        klasses.put(klass,klassMates);
      }
    }
  }
  klassMates.add(permission);
  if (klass == AllPermission.class) {
    allEnabled=true;
  }
}
