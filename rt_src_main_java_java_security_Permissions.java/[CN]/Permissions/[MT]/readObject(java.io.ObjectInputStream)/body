{
  ObjectInputStream.GetField fields=in.readFields();
  Map perms=(Map)fields.get("perms",null);
  klasses=new HashMap();
synchronized (klasses) {
    for (Iterator iter=perms.entrySet().iterator(); iter.hasNext(); ) {
      Map.Entry entry=(Map.Entry)iter.next();
      Class key=(Class)entry.getKey();
      PermissionCollection pc=(PermissionCollection)entry.getValue();
      if (key != pc.elements().nextElement().getClass()) {
        throw new InvalidObjectException(Messages.getString("security.22"));
      }
      klasses.put(key,pc);
    }
  }
  allEnabled=fields.get("allPermission",null) != null;
  if (allEnabled && !klasses.containsKey(AllPermission.class)) {
    throw new InvalidObjectException(Messages.getString("security.23"));
  }
}
