{
  if (filename.endsWith("/")) {
    return (String)types.get("html");
  }
  int lastCharInExtension=filename.lastIndexOf('#');
  if (lastCharInExtension < 0) {
    lastCharInExtension=filename.length();
  }
  int firstCharInExtension=filename.lastIndexOf('.') + 1;
  String ext="";
  if (firstCharInExtension > filename.lastIndexOf('/')) {
    ext=filename.substring(firstCharInExtension,lastCharInExtension);
  }
  return types.getProperty(ext.toLowerCase());
}
