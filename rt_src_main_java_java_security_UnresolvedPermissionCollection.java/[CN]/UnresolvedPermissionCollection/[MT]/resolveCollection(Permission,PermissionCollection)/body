{
  String klass=target.getClass().getName();
  if (klasses.containsKey(klass)) {
synchronized (klasses) {
      Collection klassMates=(Collection)klasses.get(klass);
      for (Iterator iter=klassMates.iterator(); iter.hasNext(); ) {
        UnresolvedPermission element=(UnresolvedPermission)iter.next();
        Permission resolved=element.resolve(target.getClass());
        if (resolved != null) {
          if (holder == null) {
            holder=target.newPermissionCollection();
            if (holder == null) {
              holder=new PermissionsHash();
            }
          }
          holder.add(resolved);
          iter.remove();
        }
      }
      if (klassMates.size() == 0) {
        klasses.remove(klass);
      }
    }
  }
  return holder;
}
