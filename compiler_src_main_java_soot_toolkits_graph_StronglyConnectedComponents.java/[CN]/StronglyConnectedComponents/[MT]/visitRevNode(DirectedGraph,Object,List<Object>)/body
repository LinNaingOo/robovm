{
  last=0;
  nodeToColor.put(startNode,Visited);
  nodeStack[last]=startNode;
  indexStack[last++]=-1;
  while (last > 0) {
    int toVisitIndex=++indexStack[last - 1];
    Object toVisitNode=nodeStack[last - 1];
    if (toVisitIndex >= graph.getPredsOf(toVisitNode).size()) {
      currentComponent.add(toVisitNode);
      nodeToComponent.put(toVisitNode,currentComponent);
      nodeToColor.put(toVisitNode,Black);
      last--;
    }
 else {
      Object childNode=graph.getPredsOf(toVisitNode).get(toVisitIndex);
      if (nodeToColor.get(childNode) == null) {
        nodeToColor.put(childNode,Visited);
        nodeStack[last]=childNode;
        indexStack[last++]=-1;
      }
 else       if (nodeToColor.get(childNode) == Black) {
        if (nodeToComponent.get(childNode) != currentComponent)         sccGraph.addEdge(nodeToComponent.get(childNode),currentComponent);
      }
    }
  }
}
