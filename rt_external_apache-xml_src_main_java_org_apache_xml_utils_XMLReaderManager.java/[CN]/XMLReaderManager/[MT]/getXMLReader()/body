{
  XMLReader reader;
  boolean readerInUse;
  if (m_readers == null) {
    m_readers=new ThreadLocal();
  }
  if (m_inUse == null) {
    m_inUse=new Hashtable();
  }
  reader=(XMLReader)m_readers.get();
  boolean threadHasReader=(reader != null);
  if (!threadHasReader || m_inUse.get(reader) == Boolean.TRUE) {
    try {
      try {
        reader=XMLReaderFactory.createXMLReader();
      }
 catch (      Exception e) {
        try {
          if (m_parserFactory == null) {
            m_parserFactory=SAXParserFactory.newInstance();
            m_parserFactory.setNamespaceAware(true);
          }
          reader=m_parserFactory.newSAXParser().getXMLReader();
        }
 catch (        ParserConfigurationException pce) {
          throw pce;
        }
      }
      try {
        reader.setFeature(NAMESPACES_FEATURE,true);
        reader.setFeature(NAMESPACE_PREFIXES_FEATURE,false);
      }
 catch (      SAXException se) {
      }
    }
 catch (    ParserConfigurationException ex) {
      throw new SAXException(ex);
    }
catch (    FactoryConfigurationError ex1) {
      throw new SAXException(ex1.toString());
    }
catch (    NoSuchMethodError ex2) {
    }
catch (    AbstractMethodError ame) {
    }
    if (!threadHasReader) {
      m_readers.set(reader);
      m_inUse.put(reader,Boolean.TRUE);
    }
  }
 else {
    m_inUse.put(reader,Boolean.TRUE);
  }
  return reader;
}
