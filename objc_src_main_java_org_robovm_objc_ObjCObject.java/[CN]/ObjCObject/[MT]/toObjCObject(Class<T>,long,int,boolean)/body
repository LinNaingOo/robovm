{
  if (handle == 0L) {
    return null;
  }
  if (cls == ObjCClass.class) {
    return (T)ObjCClass.toObjCClass(handle);
  }
synchronized (objcBridgeLock) {
    T o=getPeerObject(handle);
    if (o != null && o.getHandle() != 0) {
      if (forceType && !cls.isAssignableFrom(o.getClass())) {
        throw new IllegalStateException("The peer object type " + o.getClass().getName() + " is not compatible with the forced type "+ cls.getName());
      }
      return o;
    }
    ObjCClass objCClass=forceType ? ObjCClass.getByType(cls) : ObjCClass.getFromObject(handle);
    Class<T> c=(Class<T>)objCClass.getType();
    o=VM.allocateObject(c);
    o.setHandle(handle);
    setPeerObject(handle,o);
    if (objCClass.isCustom()) {
      VM.setBoolean(VM.getObjectAddress(o) + CUSTOM_CLASS_OFFSET,true);
    }
    o.afterMarshaled(afterMarshaledFlags);
    return o;
  }
}
