{
  if (hasResponse()) {
    return;
  }
  if (responseSource == null) {
    throw new IllegalStateException("readResponse() without sendRequest()");
  }
  if (!responseSource.requiresConnection()) {
    return;
  }
  if (sentRequestMillis == -1) {
    int contentLength=requestBodyOut instanceof RetryableOutputStream ? ((RetryableOutputStream)requestBodyOut).contentLength() : -1;
    writeRequestHeaders(contentLength);
  }
  if (requestBodyOut != null) {
    requestBodyOut.close();
    if (requestBodyOut instanceof RetryableOutputStream) {
      ((RetryableOutputStream)requestBodyOut).writeToSocket(requestOut);
    }
  }
  requestOut.flush();
  requestOut=socketOut;
  readResponseHeaders();
  responseHeaders.setLocalTimestamps(sentRequestMillis,System.currentTimeMillis());
  if (responseSource == ResponseSource.CONDITIONAL_CACHE) {
    if (cachedResponseHeaders.validate(responseHeaders)) {
      release(true);
      ResponseHeaders combinedHeaders=cachedResponseHeaders.combine(responseHeaders);
      setResponse(combinedHeaders,cachedResponseBody);
      if (responseCache instanceof ExtendedResponseCache) {
        ExtendedResponseCache httpResponseCache=(ExtendedResponseCache)responseCache;
        httpResponseCache.trackConditionalCacheHit();
        httpResponseCache.update(cacheResponse,getHttpConnectionToCache());
      }
      return;
    }
 else {
      IoUtils.closeQuietly(cachedResponseBody);
    }
  }
  if (hasResponseBody()) {
    maybeCache();
  }
  initContentStream(getTransferStream());
}
