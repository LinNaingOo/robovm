{
  factoryField.set(null,null);
  URL.setURLStreamHandlerFactory(oldFactory);
  try {
    System.setProperty("java.protocol.handler.pkgs",getHandlerPackageName());
    URLConnection connection=new URL("http://android.com/").openConnection();
    assertTrue(connection instanceof Handler.HandlerURLConnection);
  }
  finally {
    System.clearProperty("java.protocol.handler.pkgs");
  }
}
