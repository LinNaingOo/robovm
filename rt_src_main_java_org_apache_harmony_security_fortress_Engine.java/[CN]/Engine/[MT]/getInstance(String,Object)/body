{
  Provider.Service serv;
  if (algorithm == null) {
    throw new NoSuchAlgorithmException(Messages.getString("security.149"));
  }
  Services.refresh();
  if (returnedService != null && Util.equalsIgnoreCase(algorithm,lastAlgorithm) && refreshNumber == Services.refreshNumber) {
    serv=returnedService;
  }
 else {
    if (Services.isEmpty()) {
      throw new NoSuchAlgorithmException(Messages.getString("security.14A",serviceName,algorithm));
    }
    serv=Services.getService(new StringBuilder(128).append(serviceName).append(".").append(Util.toUpperCase(algorithm)).toString());
    if (serv == null) {
      throw new NoSuchAlgorithmException(Messages.getString("security.14A",serviceName,algorithm));
    }
    returnedService=serv;
    lastAlgorithm=algorithm;
    refreshNumber=Services.refreshNumber;
  }
  spi=serv.newInstance(param);
  this.provider=serv.getProvider();
}
