{
  checkNotNull(source);
  checkOpenConnected();
  if (!source.hasRemaining()) {
    return 0;
  }
  ByteBuffer writeBuffer=null;
  byte[] writeArray=null;
  int oldposition=source.position();
  int result;
  if (source.isDirect() || source.hasArray()) {
    writeBuffer=source;
  }
 else {
    writeArray=new byte[source.remaining()];
    source.get(writeArray);
    writeBuffer=ByteBuffer.wrap(writeArray);
  }
  result=writeImpl(writeBuffer);
  if (result > 0) {
    source.position(oldposition + result);
  }
  return result;
}
