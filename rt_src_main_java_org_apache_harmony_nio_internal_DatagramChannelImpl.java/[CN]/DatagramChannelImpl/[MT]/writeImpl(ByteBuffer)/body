{
synchronized (writeLock) {
    int result=0;
    try {
      begin();
      int length=buf.remaining();
      int start=buf.position();
      if (buf.isDirect()) {
        long address=AddressUtil.getDirectBufferAddress(buf);
        result=networkSystem.sendConnectedDatagramDirect(fd,address,start,length,isBound);
      }
 else {
        start+=buf.arrayOffset();
        result=networkSystem.sendConnectedDatagram(fd,buf.array(),start,length,isBound);
      }
      return result;
    }
 catch (    SocketException e) {
      if (e.getCause() instanceof ErrorCodeException) {
        if (ERRCODE_SOCKET_NONBLOCKING_WOULD_BLOCK == ((ErrorCodeException)e.getCause()).getErrorCode()) {
          return result;
        }
      }
      throw e;
    }
 finally {
      end(result > 0);
    }
  }
}
