{
  reset();
  Arch arch=config.getArch();
  OS os=config.getOs();
  try {
    config.getLogger().debug("Compiling %s (%s %s)",clazz,os,arch);
    output.reset();
    compile(clazz,output);
  }
 catch (  Throwable t) {
    if (t instanceof IOException) {
      throw (IOException)t;
    }
    if (t instanceof RuntimeException) {
      throw (RuntimeException)t;
    }
    throw new RuntimeException(t);
  }
  byte[] llData=output.toByteArray();
  if (config.isDumpIntermediates()) {
    File llFile=config.getLlFile(clazz);
    llFile.getParentFile().mkdirs();
    FileUtils.writeByteArrayToFile(llFile,llData);
  }
  Context context=new Context();
  Module module=Module.parseIR(context,llData,clazz.getClassName());
  PassManager passManager=createPassManager();
  passManager.run(module);
  passManager.dispose();
  if (config.isDumpIntermediates()) {
    File bcFile=config.getBcFile(clazz);
    bcFile.getParentFile().mkdirs();
    module.writeBitcode(bcFile);
  }
  String triple=config.getTriple();
  Target target=Target.lookupTarget(triple);
  TargetMachine targetMachine=target.createTargetMachine(triple,"generic",null,null,null,null);
  targetMachine.setAsmVerbosityDefault(true);
  targetMachine.setFunctionSections(true);
  targetMachine.setDataSections(true);
  targetMachine.getOptions().setNoFramePointerElim(true);
  output.reset();
  targetMachine.emit(module,output,CodeGenFileType.AssemblyFile);
  module.dispose();
  context.dispose();
  byte[] asm=output.toByteArray();
  output.reset();
  patchAsmWithFunctionSizes(clazz,new ByteArrayInputStream(asm),output);
  asm=output.toByteArray();
  if (config.isDumpIntermediates()) {
    File sFile=config.getSFile(clazz);
    sFile.getParentFile().mkdirs();
    FileUtils.writeByteArrayToFile(sFile,asm);
  }
  File oFile=config.getOFile(clazz);
  oFile.getParentFile().mkdirs();
  BufferedOutputStream oOut=new BufferedOutputStream(new FileOutputStream(oFile));
  targetMachine.assemble(asm,clazz.getClassName(),oOut);
  oOut.close();
  targetMachine.dispose();
}
