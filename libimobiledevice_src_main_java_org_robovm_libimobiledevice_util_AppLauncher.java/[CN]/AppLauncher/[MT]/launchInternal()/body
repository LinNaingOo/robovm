{
  install();
  IDeviceConnection conn=null;
  String appPath=null;
  try (LockdowndClient lockdowndClient=new LockdowndClient(device,getClass().getSimpleName(),true)){
    appPath=getAppPath(lockdowndClient,appId);
    if (appPathCallback != null) {
      appPathCallback.setRemoteAppPath(appPath);
    }
    LockdowndServiceDescriptor debugService=null;
    try {
      debugService=lockdowndClient.startService(DEBUG_SERVER_SERVICE_NAME);
    }
 catch (    LibIMobileDeviceException e) {
      if (e.getErrorCode() == LibIMobileDeviceConstants.LOCKDOWN_E_INVALID_SERVICE) {
        mountDeveloperImage(lockdowndClient);
        debugService=lockdowndClient.startService(DEBUG_SERVER_SERVICE_NAME);
      }
 else {
        throw e;
      }
    }
    conn=device.connect(debugService.getPort());
    log("Debug server port: " + debugService.getPort());
  }
   log("Launching app...");
  try {
    if (localPort == -1) {
      return pipeStdOut(conn,appPath);
    }
 else {
      return forward(conn,appPath);
    }
  }
  finally {
    conn.dispose();
  }
}
