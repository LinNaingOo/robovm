{
  try (LockdowndClient lockdowndClient=new LockdowndClient(device,getClass().getSimpleName(),true)){
    LockdowndServiceDescriptor afcService=lockdowndClient.startService(AfcClient.SERVICE_NAME);
    try (AfcClient afcClient=new AfcClient(device,afcService)){
      afcClient.upload(localAppPath,"/PublicStaging",new UploadProgressCallback(){
        public void progress(        File path,        int percentComplete){
          if (uploadProgressCallback != null) {
            uploadProgressCallback.progress(path,percentComplete);
          }
 else {
            log("[%3d%%] Uploading %s",percentComplete / 2,path);
          }
        }
        public void success(){
          if (uploadProgressCallback != null) {
            uploadProgressCallback.success();
          }
        }
        public void error(        String message){
          if (uploadProgressCallback != null) {
            uploadProgressCallback.error(message);
          }
 else {
            log("Error: %s",message);
          }
        }
      }
);
    }
   }
 }
