{
  if (!connection.getSocket().isClosed() && keepAlive) {
    HttpConfiguration config=connection.getHttpConfiguration();
    List<HttpConnection> connections=freeConnectionMap.get(config);
    if (connections == null) {
      connections=new ArrayList<HttpConnection>();
      freeConnectionMap.put(config,connections);
    }
    if (connections.size() < HttpConnectionManager.maxConnections) {
      if (!connections.contains(connection)) {
        connections.add(connection);
      }
    }
 else {
      connection.closeSocketAndStreams();
    }
  }
 else {
    connection.closeSocketAndStreams();
  }
}
