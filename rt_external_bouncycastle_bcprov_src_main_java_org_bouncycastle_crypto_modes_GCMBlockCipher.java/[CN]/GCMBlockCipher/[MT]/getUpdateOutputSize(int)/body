{
  int totalData=len + bufOff;
  if (!forEncryption) {
    if (totalData < macSize) {
      return 0;
    }
    totalData-=macSize;
  }
  return totalData - totalData % BLOCK_SIZE;
}
