{
  DatabaseX dbx=null;
  try {
    dbx=new DatabaseX();
    dbx.open(dbfile,readonly ? SQLite.Constants.SQLITE_OPEN_READONLY : (SQLite.Constants.SQLITE_OPEN_READWRITE | SQLite.Constants.SQLITE_OPEN_CREATE),vfs);
    dbx.set_encoding(enc);
  }
 catch (  SQLite.Exception e) {
    throw new SQLException(e.toString());
  }
  int loop=0;
  while (true) {
    try {
      dbx.exec("PRAGMA short_column_names = off;",null);
      dbx.exec("PRAGMA full_column_names = on;",null);
      dbx.exec("PRAGMA empty_result_callbacks = on;",null);
      if (SQLite.Database.version().compareTo("2.6.0") >= 0) {
        dbx.exec("PRAGMA show_datatypes = on;",null);
      }
    }
 catch (    SQLite.Exception e) {
      if (dbx.last_error() != SQLite.Constants.SQLITE_BUSY || !busy0(dbx,++loop)) {
        try {
          dbx.close();
        }
 catch (        SQLite.Exception ee) {
        }
        throw new SQLException(e.toString());
      }
      continue;
    }
    break;
  }
  return dbx;
}
