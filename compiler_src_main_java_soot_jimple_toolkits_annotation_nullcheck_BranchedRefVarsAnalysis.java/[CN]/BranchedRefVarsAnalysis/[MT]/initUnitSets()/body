{
  int cap=graph.size() * 2 + 1;
  float load=0.7f;
  unitToGenerateSet=new HashMap<Unit,FlowSet>(cap,load);
  unitToPreserveSet=new HashMap<Unit,FlowSet>(cap,load);
  unitToAnalyzedChecksSet=new HashMap<Unit,HashSet<Value>>(cap,load);
  unitToArrayRefChecksSet=new HashMap<Unit,HashSet<Value>>(cap,load);
  unitToInstanceFieldRefChecksSet=new HashMap<Unit,HashSet<Value>>(cap,load);
  unitToInstanceInvokeExprChecksSet=new HashMap<Unit,HashSet<Value>>(cap,load);
  unitToLengthExprChecksSet=new HashMap<Unit,HashSet<Value>>(cap,load);
  Iterator unitIt=graph.iterator();
  while (unitIt.hasNext()) {
    Unit s=(Unit)unitIt.next();
    FlowSet genSet=emptySet.clone();
    FlowSet preSet=fullSet.clone();
    HashSet<Value> analyzedChecksSet=new HashSet<Value>(5,load);
    HashSet<Value> arrayRefChecksSet=new HashSet<Value>(5,load);
    HashSet<Value> instanceFieldRefChecksSet=new HashSet<Value>(5,load);
    HashSet<Value> instanceInvokeExprChecksSet=new HashSet<Value>(5,load);
    HashSet<Value> lengthExprChecksSet=new HashSet<Value>(5,load);
    if (careForMethodCalls && ((Stmt)s).containsInvokeExpr()) {
      uListAddTopToFlowSet(refTypeInstFields,genSet,preSet);
      uListAddTopToFlowSet(refTypeStaticFields,genSet,preSet);
    }
    if (careForAliases && (s instanceof AssignStmt)) {
      AssignStmt as=(AssignStmt)s;
      Value lhs=as.getLeftOp();
      if (refTypeInstFieldBases.contains(lhs)) {
        Iterator<EquivalentValue> refTypeInstFieldsIt=refTypeInstFields.iterator();
        while (refTypeInstFieldsIt.hasNext()) {
          EquivalentValue eifr=refTypeInstFieldsIt.next();
          InstanceFieldRef ifr=(InstanceFieldRef)eifr.getValue();
          if (ifr.getBase() == lhs) {
            uAddTopToFlowSet(eifr,genSet,preSet);
          }
        }
      }
      if (lhs instanceof InstanceFieldRef) {
        String lhsName=((InstanceFieldRef)lhs).getField().getName();
        Iterator<EquivalentValue> refTypeInstFieldsIt=refTypeInstFields.iterator();
        while (refTypeInstFieldsIt.hasNext()) {
          EquivalentValue eifr=refTypeInstFieldsIt.next();
          InstanceFieldRef ifr=(InstanceFieldRef)eifr.getValue();
          String name=ifr.getField().getName();
          if (name.equals(lhsName)) {
            uAddTopToFlowSet(eifr,genSet,preSet);
          }
        }
      }
    }
{
      Iterator boxIt=s.getDefBoxes().iterator();
      while (boxIt.hasNext()) {
        ValueBox box=(ValueBox)boxIt.next();
        Value boxValue=box.getValue();
        if (isAnalyzedRef(boxValue)) {
          uAddTopToFlowSet(boxValue,genSet,preSet);
        }
      }
    }
    if (s instanceof DefinitionStmt) {
      DefinitionStmt as=(DefinitionStmt)s;
      Value ro=as.getRightOp();
      Value lo=as.getLeftOp();
      if (ro instanceof CastExpr)       ro=((CastExpr)ro).getOp();
      if (isAnalyzedRef(lo)) {
        if (isAlwaysNonNull(ro)) {
          uAddInfoToFlowSet(lo,kNonNull,genSet,preSet);
        }
 else         if (isAlwaysNull(ro)) {
          uAddInfoToFlowSet(lo,kNull,genSet,preSet);
        }
 else         if (isAlwaysTop(ro)) {
          uAddTopToFlowSet(lo,genSet,preSet);
        }
      }
    }
{
      Iterator boxIt;
      boxIt=s.getUseBoxes().iterator();
      while (boxIt.hasNext()) {
        Value boxValue=((ValueBox)boxIt.next()).getValue();
        Value base=null;
        if (boxValue instanceof InstanceFieldRef) {
          base=((InstanceFieldRef)(boxValue)).getBase();
          instanceFieldRefChecksSet.add(base);
        }
 else         if (boxValue instanceof ArrayRef) {
          base=((ArrayRef)(boxValue)).getBase();
          arrayRefChecksSet.add(base);
        }
 else         if (boxValue instanceof InstanceInvokeExpr) {
          base=((InstanceInvokeExpr)boxValue).getBase();
          instanceInvokeExprChecksSet.add(base);
        }
 else         if (boxValue instanceof LengthExpr) {
          base=((LengthExpr)boxValue).getOp();
          lengthExprChecksSet.add(base);
        }
 else         if (s instanceof ThrowStmt) {
          base=((ThrowStmt)s).getOp();
        }
 else         if (s instanceof MonitorStmt) {
          base=((MonitorStmt)s).getOp();
        }
        if (base != null && isAnalyzedRef(base)) {
          uAddInfoToFlowSet(base,kNonNull,genSet,preSet);
          analyzedChecksSet.add(base);
        }
      }
      boxIt=s.getDefBoxes().iterator();
      while (boxIt.hasNext()) {
        Value boxValue=((ValueBox)boxIt.next()).getValue();
        Value base=null;
        if (boxValue instanceof InstanceFieldRef) {
          base=((InstanceFieldRef)(boxValue)).getBase();
          instanceFieldRefChecksSet.add(base);
        }
 else         if (boxValue instanceof ArrayRef) {
          base=((ArrayRef)(boxValue)).getBase();
          arrayRefChecksSet.add(base);
        }
 else         if (boxValue instanceof InstanceInvokeExpr) {
          base=((InstanceInvokeExpr)boxValue).getBase();
          instanceInvokeExprChecksSet.add(base);
        }
 else         if (boxValue instanceof LengthExpr) {
          base=((LengthExpr)boxValue).getOp();
          lengthExprChecksSet.add(base);
        }
 else         if (s instanceof ThrowStmt) {
          base=((ThrowStmt)s).getOp();
        }
 else         if (s instanceof MonitorStmt) {
          base=((MonitorStmt)s).getOp();
        }
        if (base != null && isAnalyzedRef(base)) {
          uAddInfoToFlowSet(base,kNonNull,genSet,preSet);
          analyzedChecksSet.add(base);
        }
      }
    }
    unitToGenerateSet.put(s,genSet);
    unitToPreserveSet.put(s,preSet);
    unitToAnalyzedChecksSet.put(s,analyzedChecksSet);
    unitToArrayRefChecksSet.put(s,arrayRefChecksSet);
    unitToInstanceFieldRefChecksSet.put(s,instanceFieldRefChecksSet);
    unitToInstanceInvokeExprChecksSet.put(s,instanceInvokeExprChecksSet);
    unitToLengthExprChecksSet.put(s,lengthExprChecksSet);
  }
}
