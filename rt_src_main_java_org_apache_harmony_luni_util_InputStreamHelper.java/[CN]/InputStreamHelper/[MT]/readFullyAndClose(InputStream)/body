{
  try {
    byte[] buffer=new byte[1024];
    int count=is.read(buffer);
    int nextByte=is.read();
    if (nextByte == -1) {
      byte[] dest=new byte[count];
      System.arraycopy(buffer,0,dest,0,count);
      return dest;
    }
    ByteArrayOutputStream baos=new ByteArrayOutputStream(count * 2);
    baos.write(buffer,0,count);
    baos.write(nextByte);
    while (true) {
      count=is.read(buffer);
      if (count == -1) {
        return baos.toByteArray();
      }
      baos.write(buffer,0,count);
    }
  }
  finally {
    is.close();
  }
}
