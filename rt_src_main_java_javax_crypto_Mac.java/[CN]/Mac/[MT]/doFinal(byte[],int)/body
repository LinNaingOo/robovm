{
  if (!isInitMac) {
    throw new IllegalStateException(Messages.getString("crypto.01"));
  }
  if (output == null) {
    throw new ShortBufferException(Messages.getString("crypto.08"));
  }
  if ((outOffset < 0) || (outOffset >= output.length)) {
    throw new ShortBufferException(Messages.getString("crypto.09",Integer.toString(outOffset)));
  }
  int t=spiImpl.engineGetMacLength();
  if (t > (output.length - outOffset)) {
    throw new ShortBufferException(Messages.getString("crypto.0A",Integer.toString(t)));
  }
  byte[] result=spiImpl.engineDoFinal();
  System.arraycopy(result,0,output,outOffset,result.length);
}
