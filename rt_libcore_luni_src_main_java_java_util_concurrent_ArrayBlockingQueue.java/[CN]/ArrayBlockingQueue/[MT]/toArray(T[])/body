{
  final Object[] items=this.items;
  final ReentrantLock lock=this.lock;
  lock.lock();
  try {
    final int count=this.count;
    final int len=a.length;
    if (len < count)     a=(T[])java.lang.reflect.Array.newInstance(a.getClass().getComponentType(),count);
    int n=items.length - takeIndex;
    if (count <= n)     System.arraycopy(items,takeIndex,a,0,count);
 else {
      System.arraycopy(items,takeIndex,a,0,n);
      System.arraycopy(items,0,a,n,count - n);
    }
    if (len > count)     a[count]=null;
    return a;
  }
  finally {
    lock.unlock();
  }
}
