{
  long callType=flags & MarshalerFlags.CALL_TYPE_MASK;
  if (callType != MarshalerFlags.CALL_TYPE_BRIDGE) {
    if (callType == MarshalerFlags.CALL_TYPE_CALLBACK) {
      throw new UnsupportedOperationException("Marshaling java.nio.Buffer to pointer " + "for callback return values is not supported");
    }
    if (callType == MarshalerFlags.CALL_TYPE_STRUCT_MEMBER) {
      throw new UnsupportedOperationException("Marshaling java.nio.Buffer to pointer " + "for struct member setter values is not supported");
    }
    throw new UnsupportedOperationException();
  }
  if (object == null) {
    return 0L;
  }
  Buffer buffer=(Buffer)object;
  if (!buffer.isDirect() && !buffer.hasArray()) {
    throw new IllegalArgumentException("Only direct and array-backed " + "java.nio.Buffers can be marshaled to pointers.");
  }
  if (buffer.isDirect()) {
    return VM.getInt(VM.getObjectAddress(buffer) + EFFECTIVE_DIRECT_ADDRESS_OFFSET);
  }
 else {
    Object array=buffer.array();
    int offset=buffer.arrayOffset();
    int shift=VM.getInt(VM.getObjectAddress(buffer) + _ELEMENT_SIZE_SHIFT_OFFSET);
    return VM.getArrayValuesAddress(array) + (offset << shift);
  }
}
