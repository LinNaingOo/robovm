{
  if (!m_mutable)   throw new RuntimeException(XSLMessages.createXPATHMessage(XPATHErrorResources.ER_NODESETDTM_NOT_MUTABLE,null));
  int insertIndex=-1;
  if (test) {
    int size=size(), i;
    for (i=size - 1; i >= 0; i--) {
      int child=elementAt(i);
      if (child == node) {
        i=-2;
        break;
      }
      DTM dtm=support.getDTM(node);
      if (!dtm.isNodeAfter(node,child)) {
        break;
      }
    }
    if (i != -2) {
      insertIndex=i + 1;
      insertElementAt(node,insertIndex);
    }
  }
 else {
    insertIndex=this.size();
    boolean foundit=false;
    for (int i=0; i < insertIndex; i++) {
      if (i == node) {
        foundit=true;
        break;
      }
    }
    if (!foundit)     addElement(node);
  }
  return insertIndex;
}
