{
  if (ci) {
    if ((ch >= 'a' && ch <= 'z') || (ch >= 'A' && ch <= 'Z')) {
      if (!inverted) {
        bits.set(Pattern.getSupplement((char)ch));
      }
 else {
        bits.clear(Pattern.getSupplement((char)ch));
      }
    }
 else     if (uci && ch > 128) {
      hasUCI=true;
      ch=Character.toLowerCase(Character.toUpperCase(ch));
    }
  }
  if (Lexer.isHighSurrogate(ch) || Lexer.isLowSurrogate(ch)) {
    if (!invertedSurrogates) {
      lowHighSurrogates.set(ch - Character.MIN_SURROGATE);
    }
 else {
      lowHighSurrogates.clear(ch - Character.MIN_SURROGATE);
    }
  }
  if (!inverted) {
    bits.set(ch);
  }
 else   bits.clear(ch);
  if (!mayContainSupplCodepoints && Character.isSupplementaryCodePoint(ch)) {
    mayContainSupplCodepoints=true;
  }
  return this;
}
