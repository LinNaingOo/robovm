{
  if (type == null) {
    throw new NullPointerException("type");
  }
synchronized (typeToClass) {
    ObjCClass c=typeToClass.get(type);
    if (c == null) {
      NativeClass nativeClassAnno=type.getAnnotation(NativeClass.class);
      String name=null;
      if (nativeClassAnno != null) {
        name=nativeClassAnno.value();
        name="".equals(name) ? type.getSimpleName() : name;
      }
 else {
        name=getCustomClassName(type);
        c=register(type,name);
      }
      if (c == null) {
        long classPtr=ObjCRuntime.objc_getClass(VM.getStringUTFChars(name));
        if (classPtr == 0L) {
          throw new ObjCClassNotFoundException(name);
        }
        c=new ObjCClass(classPtr,type,name,false);
      }
      typeToClass.put(type,c);
      nameToClass.put(name,c);
    }
    return c;
  }
}
