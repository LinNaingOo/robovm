{
  if (node.right == null) {
    if (node.left != null) {
      attachToParent(node,node.left);
    }
 else {
      attachNullToParent(node);
    }
    fixNextChain(node);
  }
 else   if (node.left == null) {
    attachToParent(node,node.right);
    fixNextChain(node);
  }
 else {
    Node<K,V> toMoveUp=node.next;
    fixNextChain(node);
    if (toMoveUp.right == null) {
      attachNullToParent(toMoveUp);
    }
 else {
      attachToParent(toMoveUp,toMoveUp.right);
    }
    toMoveUp.left=node.left;
    if (node.left != null) {
      node.left.parent=toMoveUp;
    }
    toMoveUp.right=node.right;
    if (node.right != null) {
      node.right.parent=toMoveUp;
    }
    attachToParentNoFixup(node,toMoveUp);
    toMoveUp.color=node.color;
  }
}
