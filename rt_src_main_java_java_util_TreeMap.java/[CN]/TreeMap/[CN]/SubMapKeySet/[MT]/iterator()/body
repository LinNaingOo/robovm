{
  Node<K,V> from;
  int fromIndex;
  if (subMap.hasStart) {
    subMap.setFirstKey();
    from=subMap.firstKeyNode;
    fromIndex=subMap.firstKeyIndex;
  }
 else {
    from=minimum(subMap.backingMap.root);
    fromIndex=from != null ? from.left_idx : 0;
  }
  if (from == null) {
    return new BoundedKeyIterator<K,V>(null,0,subMap.backingMap,null,0);
  }
  if (!subMap.hasEnd) {
    return new UnboundedKeyIterator<K,V>(subMap.backingMap,from,from == null ? 0 : from.right_idx - fromIndex);
  }
  subMap.setLastKey();
  Node<K,V> to=subMap.lastKeyNode;
  Comparable<K> object=subMap.backingMap.comparator == null ? toComparable((K)subMap.endKey) : null;
  int toIndex=subMap.lastKeyIndex + (subMap.lastKeyNode != null && (!subMap.lastKeyNode.keys[subMap.lastKeyIndex].equals(subMap.endKey)) ? 1 : 0);
  if (subMap.lastKeyNode != null && toIndex > subMap.lastKeyNode.right_idx) {
    to=to.next;
    toIndex=to != null ? to.left_idx : 0;
  }
  if (to == null) {
    return new UnboundedKeyIterator(subMap.backingMap,from,fromIndex);
  }
 else   return new BoundedKeyIterator<K,V>(from,from == null ? 0 : fromIndex,subMap.backingMap,to,to == null ? 0 : toIndex);
}
