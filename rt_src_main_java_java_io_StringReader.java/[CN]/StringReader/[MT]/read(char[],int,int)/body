{
synchronized (lock) {
    if (isClosed()) {
      throw new IOException(Messages.getString("luni.D6"));
    }
    if (offset < 0 || offset > buf.length) {
      throw new ArrayIndexOutOfBoundsException(Messages.getString("luni.12",offset));
    }
    if (len < 0 || len > buf.length - offset) {
      throw new ArrayIndexOutOfBoundsException(Messages.getString("luni.18",len));
    }
    if (len == 0) {
      return 0;
    }
    if (pos == this.count) {
      return -1;
    }
    int end=pos + len > this.count ? this.count : pos + len;
    str.getChars(pos,end,buf,offset);
    int read=end - pos;
    pos=end;
    return read;
  }
}
