{
  int sport=startServer("SServer setSendBufferSize");
  try {
    int portNumber=Support_PortManager.getNextPort();
    s=new Socket(InetAddress.getLocalHost().getHostName(),sport,null,portNumber);
    s.setSendBufferSize(134);
    assertTrue("Incorrect buffer size",s.getSendBufferSize() >= 134);
    ensureExceptionThrownIfOptionIsUnsupportedOnOS(SO_SNDBUF);
  }
 catch (  Exception e) {
    handleException(e,SO_SNDBUF);
  }
  try {
    int portNumber=Support_PortManager.getNextPort();
    s=new Socket(InetAddress.getLocalHost(),sport,null,portNumber);
    s.close();
    try {
      s.getSendBufferSize();
      fail("IOException was not thrown.");
    }
 catch (    IOException ioe) {
    }
  }
 catch (  Exception e) {
    fail("Unexpected exception was thrown: " + e.toString());
  }
}
