{
  if (home == null) {
    home=Home.find();
  }
  if (llvmHomeDir == null) {
    llvmHomeDir=findLlvmHomeDir();
  }
  if (mainJar != null) {
    mainClass=getMainClass(mainJar);
    classpath.add(mainJar);
  }
  if (!skipLinking && executableName == null && mainClass == null) {
    throw new IllegalArgumentException("No target and no main class specified");
  }
  if (!skipLinking && classpath.isEmpty()) {
    throw new IllegalArgumentException("No classpath specified");
  }
  if (skipLinking) {
    skipInstall=true;
  }
  if (executableName == null) {
    executableName=mainClass;
  }
  List<File> realBootclasspath=bootclasspath;
  if (!skipRuntimeLib) {
    realBootclasspath=new ArrayList<File>(bootclasspath);
    realBootclasspath.add(0,home.rtPath);
  }
  this.clazzes=new Clazzes(this,realBootclasspath,classpath);
  if (!skipInstall) {
    if (installDir == null) {
      installDir=new File(".",executableName);
    }
    installDir.mkdirs();
  }
  if (target == null) {
    target=new ConsoleTarget();
  }
  target.init(this);
  OS os=target.getOS();
  Arch arch=target.getArch();
  osArchDepLibDir=new File(new File(home.libVmDir,os.toString()),arch.toString());
  File osDir=new File(cacheDir,os.toString());
  File archDir=new File(osDir,arch.toString());
  cacheDir=new File(archDir,"default");
  cacheDir.mkdirs();
  return this;
}
