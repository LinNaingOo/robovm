{
  logger.debug("Creating archive file '%s' from files in directory '%s'",output,dir);
  output.getParentFile().mkdirs();
  ZipOutputStream out=null;
  try {
    out=new ZipOutputStream(new BufferedOutputStream(new FileOutputStream(output)));
    for (    File f : (Collection<File>)FileUtils.listFiles(dir,null,true)) {
      ZipEntry newEntry=new ZipEntry(f.getAbsolutePath().substring(dir.getAbsolutePath().length() + 1).replace(File.separatorChar,'/'));
      newEntry.setTime(f.lastModified());
      out.putNextEntry(newEntry);
      InputStream in=null;
      try {
        if (!skipClassFiles || !f.getName().toLowerCase().endsWith(".class")) {
          in=new BufferedInputStream(new FileInputStream(f));
        }
 else {
          in=new ByteArrayInputStream(new byte[0]);
        }
        IOUtils.copy(in,out);
        out.closeEntry();
      }
  finally {
        IOUtils.closeQuietly(in);
      }
    }
  }
  finally {
    IOUtils.closeQuietly(out);
  }
}
