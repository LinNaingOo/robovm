{
  int capacity=65536;
  byte[] bytes=new byte[capacity];
  byte[] bs={'A','B','C','D','E','F','G','H'};
  for (int i=0; i < bytes.length; i++) {
    bytes[i]=bs[i / 8192];
  }
  String inputStr=new String(bytes);
  int len=inputStr.length();
  File f=File.createTempFile("FileWriterBugTest ",null);
  FileWriter writer=new FileWriter(f);
  writer.write(inputStr);
  writer.close();
  long flen=f.length();
  FileReader reader=new FileReader(f);
  char[] outChars=new char[capacity];
  int outCount=reader.read(outChars);
  String outStr=new String(outChars,0,outCount);
  f.deleteOnExit();
  assertEquals(len,flen);
  assertEquals(inputStr,outStr);
}
