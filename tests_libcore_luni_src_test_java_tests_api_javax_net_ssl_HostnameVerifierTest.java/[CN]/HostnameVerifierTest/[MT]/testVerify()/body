{
  CertificateFactory cf=CertificateFactory.getInstance("X.509");
  InputStream in;
  X509Certificate x509;
  in=new ByteArrayInputStream(X509_FOO);
  x509=(X509Certificate)cf.generateCertificate(in);
  mySSLSession session=new mySSLSession(new X509Certificate[]{x509});
  HostnameVerifier verifier=HttpsURLConnection.getDefaultHostnameVerifier();
  assertTrue(verifier.verify("foo.com",session));
  assertFalse(verifier.verify("a.foo.com",session));
  assertFalse(verifier.verify("bar.com",session));
  in=new ByteArrayInputStream(X509_HANAKO);
  x509=(X509Certificate)cf.generateCertificate(in);
  session=new mySSLSession(new X509Certificate[]{x509});
  assertTrue(verifier.verify("\u82b1\u5b50.co.jp",session));
  assertFalse(verifier.verify("a.\u82b1\u5b50.co.jp",session));
  in=new ByteArrayInputStream(X509_FOO_BAR);
  x509=(X509Certificate)cf.generateCertificate(in);
  session=new mySSLSession(new X509Certificate[]{x509});
  assertFalse(verifier.verify("foo.com",session));
  assertFalse(verifier.verify("a.foo.com",session));
  assertTrue(verifier.verify("bar.com",session));
  assertFalse(verifier.verify("a.bar.com",session));
  in=new ByteArrayInputStream(X509_FOO_BAR_HANAKO);
  x509=(X509Certificate)cf.generateCertificate(in);
  session=new mySSLSession(new X509Certificate[]{x509});
  assertTrue(verifier.verify("foo.com",session));
  assertFalse(verifier.verify("a.foo.com",session));
  in=new ByteArrayInputStream(X509_NO_CNS_FOO);
  x509=(X509Certificate)cf.generateCertificate(in);
  session=new mySSLSession(new X509Certificate[]{x509});
  assertTrue(verifier.verify("foo.com",session));
  assertFalse(verifier.verify("a.foo.com",session));
  in=new ByteArrayInputStream(X509_NO_CNS_FOO);
  x509=(X509Certificate)cf.generateCertificate(in);
  session=new mySSLSession(new X509Certificate[]{x509});
  assertTrue(verifier.verify("foo.com",session));
  assertFalse(verifier.verify("a.foo.com",session));
  in=new ByteArrayInputStream(X509_THREE_CNS_FOO_BAR_HANAKO);
  x509=(X509Certificate)cf.generateCertificate(in);
  session=new mySSLSession(new X509Certificate[]{x509});
  assertFalse(verifier.verify("foo.com",session));
  assertFalse(verifier.verify("a.foo.com",session));
  assertFalse(verifier.verify("bar.com",session));
  assertFalse(verifier.verify("a.bar.com",session));
  assertTrue(verifier.verify("\u82b1\u5b50.co.jp",session));
  assertFalse(verifier.verify("a.\u82b1\u5b50.co.jp",session));
  in=new ByteArrayInputStream(X509_WILD_FOO);
  x509=(X509Certificate)cf.generateCertificate(in);
  session=new mySSLSession(new X509Certificate[]{x509});
  assertTrue(verifier.verify("foo.com",session));
  assertTrue(verifier.verify("www.foo.com",session));
  assertTrue(verifier.verify("\u82b1\u5b50.foo.com",session));
  assertFalse(verifier.verify("a.b.foo.com",session));
  in=new ByteArrayInputStream(X509_WILD_CO_JP);
  x509=(X509Certificate)cf.generateCertificate(in);
  session=new mySSLSession(new X509Certificate[]{x509});
  assertTrue(verifier.verify("foo.co.jp",session));
  assertTrue(verifier.verify("\u82b1\u5b50.co.jp",session));
  in=new ByteArrayInputStream(X509_WILD_FOO_BAR_HANAKO);
  x509=(X509Certificate)cf.generateCertificate(in);
  session=new mySSLSession(new X509Certificate[]{x509});
  assertTrue(verifier.verify("foo.com",session));
  assertTrue(verifier.verify("www.foo.com",session));
  assertTrue(verifier.verify("\u82b1\u5b50.foo.com",session));
  assertFalse(verifier.verify("a.b.foo.com",session));
}
