{
  StringBuilder result=new StringBuilder();
  if (scheme != null) {
    result.append(scheme.toLowerCase());
    result.append(':');
  }
  if (opaque) {
    result.append(schemespecificpart);
  }
 else {
    if (authority != null) {
      result.append("//");
      if (host == null) {
        result.append(authority);
      }
 else {
        if (userinfo != null) {
          result.append(userinfo + "@");
        }
        result.append(host.toLowerCase());
        if (port != -1) {
          result.append(":" + port);
        }
      }
    }
    if (path != null) {
      result.append(path);
    }
    if (query != null) {
      result.append('?');
      result.append(query);
    }
  }
  if (fragment != null) {
    result.append('#');
    result.append(fragment);
  }
  return convertHexToLowerCase(result.toString());
}
