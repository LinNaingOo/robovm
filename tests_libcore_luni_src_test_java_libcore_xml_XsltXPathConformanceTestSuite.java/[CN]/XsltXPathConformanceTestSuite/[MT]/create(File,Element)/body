{
  Element filePathElement=(Element)testCaseElement.getElementsByTagName("file-path").item(0);
  Element purposeElement=(Element)testCaseElement.getElementsByTagName("purpose").item(0);
  Element specCitationElement=(Element)testCaseElement.getElementsByTagName("spec-citation").item(0);
  Element scenarioElement=(Element)testCaseElement.getElementsByTagName("scenario").item(0);
  String category=testCaseElement.getAttribute("category");
  String id=testCaseElement.getAttribute("id");
  String name=category + "." + id;
  String purpose=purposeElement != null ? purposeElement.getTextContent() : "";
  String spec="place=" + specCitationElement.getAttribute("place") + " type"+ specCitationElement.getAttribute("type")+ " version="+ specCitationElement.getAttribute("version")+ " spec="+ specCitationElement.getAttribute("spec");
  String operation=scenarioElement.getAttribute("operation");
  Element principalDataElement=null;
  Element principalStylesheetElement=null;
  Element principalElement=null;
  for (  Element element : elementsOf(scenarioElement.getChildNodes())) {
    String role=element.getAttribute("role");
    if (role.equals("principal-data")) {
      principalDataElement=element;
    }
 else     if (role.equals("principal-stylesheet")) {
      principalStylesheetElement=element;
    }
 else     if (role.equals("principal")) {
      principalElement=element;
    }
 else     if (!role.equals("supplemental-stylesheet") && !role.equals("supplemental-data")) {
      return new MisspecifiedTest("Unexpected element at " + name);
    }
  }
  String testDirectory=filePathElement.getTextContent();
  File inBase=new File(base,testDirectory);
  File outBase=new File(new File(base,"REF_OUT"),testDirectory);
  if (principalDataElement == null || principalStylesheetElement == null) {
    return new MisspecifiedTest("Expected <scenario> to have " + "principal=data and principal-stylesheet elements at " + name);
  }
  try {
    File principalData=findFile(inBase,principalDataElement.getTextContent());
    File principalStylesheet=findFile(inBase,principalStylesheetElement.getTextContent());
    final File principal;
    final String compareAs;
    if (!operation.equals("execution-error")) {
      if (principalElement == null) {
        return new MisspecifiedTest("Expected <scenario> to have principal element at " + name);
      }
      principal=findFile(outBase,principalElement.getTextContent());
      compareAs=principalElement.getAttribute("compare");
    }
 else {
      principal=null;
      compareAs=null;
    }
    return new XsltTest(category,id,purpose,spec,principalData,principalStylesheet,principal,operation,compareAs);
  }
 catch (  FileNotFoundException e) {
    return new MisspecifiedTest(e.getMessage() + " at " + name);
  }
}
