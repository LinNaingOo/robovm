{
  ServerSocketChannel ssc=ServerSocketChannel.open();
  ssc.configureBlocking(false);
  ssc.socket().bind(null);
  SocketChannel sc=SocketChannel.open();
  sc.configureBlocking(false);
  boolean connected=sc.connect(ssc.socket().getLocalSocketAddress());
  SocketChannel sock=ssc.accept();
  if (!connected) {
    sc.finishConnect();
  }
  ByteBuffer buf1=ByteBuffer.allocate(10);
  sc.socket().setSendBufferSize(512);
  int bufSize=sc.socket().getSendBufferSize();
  ByteBuffer buf2=ByteBuffer.allocate(bufSize * 10);
  ByteBuffer[] sent=new ByteBuffer[2];
  sent[0]=buf1;
  sent[1]=buf2;
  long whole=buf1.remaining() + buf2.remaining();
  long write=sc.write(sent);
  ssc.close();
  sc.close();
  sock.close();
  assertTrue(whole == (write + buf1.remaining() + buf2.remaining()));
}
