{
  openCheck();
  if (!buffer.hasRemaining()) {
    return 0;
  }
  boolean completed=false;
  int bytesRead=0;
synchronized (repositioningLock) {
    if (buffer.isDirect()) {
      DirectBuffer directBuffer=(DirectBuffer)buffer;
      long address=directBuffer.getEffectiveAddress().toLong();
      try {
        begin();
        bytesRead=(int)fileSystem.readDirect(handle,address,buffer.position(),buffer.remaining());
        completed=true;
      }
  finally {
        end(completed && bytesRead >= 0);
      }
    }
 else {
      try {
        begin();
        bytesRead=(int)fileSystem.read(handle,buffer.array(),buffer.arrayOffset() + buffer.position(),buffer.remaining());
        completed=true;
      }
  finally {
        end(completed && bytesRead >= 0);
      }
    }
    if (bytesRead > 0) {
      buffer.position(buffer.position() + bytesRead);
    }
  }
  return bytesRead;
}
