{
  if ((position < 0) || (size < 0)) {
    throw new IllegalArgumentException(Messages.getString("nio.0A"));
  }
  int lockType=shared ? IFileSystem.SHARED_LOCK_TYPE : IFileSystem.EXCLUSIVE_LOCK_TYPE;
  FileLock pendingLock=new FileLockImpl(this,position,size,shared);
  lockManager.addLock(pendingLock);
  if (fileSystem.lock(handle,position,size,lockType,wait)) {
    return pendingLock;
  }
  lockManager.removeLock(pendingLock);
  return null;
}
