{
  ArrayList<UnitBox> unitBoxList=new ArrayList<UnitBox>();
{
    Iterator<Unit> it=unitChain.iterator();
    while (it.hasNext()) {
      Unit item=it.next();
      if (branchTarget) {
        if (item.branches())         unitBoxList.addAll(item.getUnitBoxes());
      }
 else {
        if (!item.branches())         unitBoxList.addAll(item.getUnitBoxes());
      }
    }
  }
{
    Iterator<Trap> it=trapChain.iterator();
    while (it.hasNext()) {
      Trap item=it.next();
      unitBoxList.addAll(item.getUnitBoxes());
    }
  }
  return unitBoxList;
}
