{
  if (offset > buf.length || offset < 0) {
    throw new ArrayIndexOutOfBoundsException(Messages.getString("luni.12",offset));
  }
  if (length < 0 || buf.length - offset < length) {
    throw new ArrayIndexOutOfBoundsException(Messages.getString("luni.18",length));
  }
  if (bytesRemaining <= 0) {
    readChunkSize();
  }
  if (atEnd) {
    disconnect(false);
    return -1;
  }
  if (length > bytesRemaining) {
    length=bytesRemaining;
  }
  int result=is.read(buf,offset,length);
  if (result > 0) {
    bytesRemaining-=result;
    if (useCaches && null != cacheOut) {
      cacheOut.write(buf,offset,result);
    }
  }
  return result;
}
