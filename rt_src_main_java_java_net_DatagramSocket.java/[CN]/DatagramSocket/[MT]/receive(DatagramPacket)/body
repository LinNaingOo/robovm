{
  checkClosedAndBind(true);
  InetAddress senderAddr;
  int senderPort;
  DatagramPacket tempPack=new DatagramPacket(new byte[1],1);
  boolean copy=false;
  SecurityManager security=System.getSecurityManager();
  if (address != null || security != null) {
    if (pack == null) {
      throw new NullPointerException();
    }
    while (true) {
      copy=false;
      try {
        senderPort=impl.peekData(tempPack);
        senderAddr=tempPack.getAddress();
      }
 catch (      SocketException e) {
        if (e.getMessage().equals("The socket does not support the operation")) {
          tempPack=new DatagramPacket(new byte[pack.getCapacity()],pack.getCapacity());
          impl.receive(tempPack);
          senderAddr=tempPack.getAddress();
          senderPort=tempPack.getPort();
          copy=true;
        }
 else {
          throw e;
        }
      }
      if (address == null) {
        try {
          security.checkAccept(senderAddr.getHostName(),senderPort);
          break;
        }
 catch (        SecurityException e) {
          if (!copy) {
            impl.receive(tempPack);
          }
        }
      }
 else       if (port == senderPort && address.equals(senderAddr)) {
        break;
      }
 else       if (!copy) {
        impl.receive(tempPack);
      }
    }
  }
  if (copy) {
    System.arraycopy(tempPack.getData(),0,pack.getData(),pack.getOffset(),tempPack.getLength());
    pack.setLengthOnly(tempPack.getLength());
    pack.setAddress(tempPack.getAddress());
    pack.setPort(tempPack.getPort());
  }
 else {
    pack.setLength(pack.getCapacity());
    impl.receive(pack);
  }
}
