{
  long refconId=CMBufferQueue.refconId.getAndIncrement();
  CMBufferCallbacksStruct callbacks=new CMBufferCallbacksStruct();
  callbacks.refcon(refconId);
  callbacks.getDecodeTimeStamp(new FunctionPtr(cbGetDecodeTimeStamp));
  callbacks.getPresentationTimeStamp(new FunctionPtr(cbGetPresentationTimeStamp));
  callbacks.getDuration(new FunctionPtr(cbGetDuration));
  callbacks.isDataReady(new FunctionPtr(cbIsDataReady));
  callbacks.compare(new FunctionPtr(cbCompare));
  callbacks.getSize(new FunctionPtr(cbGetSize));
  CMBufferQueuePtr ptr=new CMBufferQueuePtr();
  CMBufferQueueError err=create(null,capacity,callbacks,ptr);
  if (err == CMBufferQueueError.No) {
synchronized (bufferQueueCallbacks) {
      bufferQueueCallbacks.put(refconId,callback);
    }
    return ptr.get();
  }
  return null;
}
