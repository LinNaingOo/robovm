{
  int len=0;
  if (currentDomains != null) {
    len+=currentDomains.length;
  }
  if (assignedDomains != null) {
    len+=assignedDomains.length;
  }
  if (len == 0) {
    return null;
  }
  ProtectionDomain[] pd=new ProtectionDomain[len];
  int cur=0;
  if (currentDomains != null) {
    Set<Principal> s=subject.getPrincipals();
    Principal[] p=s.toArray(new Principal[s.size()]);
    for (cur=0; cur < currentDomains.length; cur++) {
      if (currentDomains[cur] != null) {
        ProtectionDomain newPD;
        newPD=new ProtectionDomain(currentDomains[cur].getCodeSource(),currentDomains[cur].getPermissions(),currentDomains[cur].getClassLoader(),p);
        pd[cur]=newPD;
      }
    }
  }
  if (assignedDomains != null) {
    System.arraycopy(assignedDomains,0,pd,cur,assignedDomains.length);
  }
  return pd;
}
