{
  KeyAgreement keyAgreement=getKeyAgreement(provider);
  keyAgreement.init(KAT_PRIVATE_KEY1);
  keyAgreement.doPhase(KAT_PUBLIC_KEY2,true);
  byte[] buffer=new byte[KAT_SECRET.length];
  int secretLengthBytes=keyAgreement.generateSecret(buffer,0);
  assertEquals(KAT_SECRET.length,secretLengthBytes);
  assertTrue(Arrays.equals(KAT_SECRET,buffer));
}
