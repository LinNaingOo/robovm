{
  if (monitor == null) {
    monitor=new NullProgressMonitor();
  }
  monitor.beginTask(configuration.getName() + "...",6);
  if (monitor.isCanceled()) {
    return;
  }
  try {
    monitor.subTask("Verifying launch attributes");
    String mainTypeName=verifyMainTypeName(configuration);
    File workingDir=verifyWorkingDirectory(configuration);
    String[] envp=getEnvironment(configuration);
    String pgmArgs=getProgramArguments(configuration);
    String vmArgs=getVMArguments(configuration);
    String[] classpath=getClasspath(configuration);
    String[] bootclasspath=getBootpath(configuration);
    if (monitor.isCanceled()) {
      return;
    }
    monitor.worked(1);
    RoboVMPlugin.consoleInfo("Building executable");
    monitor.subTask("Creating source locator");
    setDefaultSourceLocator(launch,configuration);
    monitor.worked(1);
    monitor.subTask("Creating build configuration");
    Config.Builder configBuilder=new Config.Builder();
    Arch arch=getArch(configuration,mode);
    OS os=getOS(configuration,mode);
    File tmpDir=new File(RoboVMPlugin.getMetadataDir(),getJavaProjectName(configuration));
    tmpDir=new File(tmpDir,configuration.getName());
    tmpDir=new File(new File(tmpDir,os.toString()),arch.toString());
    tmpDir=new File(tmpDir,mainTypeName);
    configBuilder.arch(arch);
    configBuilder.os(os);
    configBuilder.debug(true);
    configBuilder.skipInstall(false);
    configBuilder.home(RoboVMPlugin.getRoboVMHome());
    if (!RoboVMPlugin.useSystemLlvm()) {
      configBuilder.llvmHomeDir(RoboVMPlugin.getLlvmHomeDir());
    }
    configBuilder.logger(RoboVMPlugin.getConsoleLogger());
    if (bootclasspath != null) {
      configBuilder.skipRuntimeLib(true);
      for (      String p : bootclasspath) {
        configBuilder.addBootClasspathEntry(new File(p));
      }
    }
    for (    String p : classpath) {
      configBuilder.addClasspathEntry(new File(p));
    }
    configBuilder.mainClass(mainTypeName);
    configBuilder.tmpDir(tmpDir);
    configBuilder.skipInstall(true);
    Config config=null;
    AppCompiler compiler=null;
    Target target=null;
    try {
      config=configure(configBuilder,configuration,mode);
      target=config.getTarget();
      compiler=new AppCompiler(config);
      if (monitor.isCanceled()) {
        return;
      }
      monitor.worked(1);
      monitor.subTask("Building executable");
      compiler.compile();
      if (monitor.isCanceled()) {
        return;
      }
      monitor.worked(1);
      RoboVMPlugin.consoleInfo("Build done");
    }
 catch (    IOException e) {
      RoboVMPlugin.consoleError("Build failed");
      throw new CoreException(new Status(IStatus.ERROR,RoboVMPlugin.PLUGIN_ID,"Build failed. Check the RoboVM console for more information.",e));
    }
    try {
      RoboVMPlugin.consoleInfo("Launching executable");
      monitor.subTask("Launching executable");
      List<String> runArgs=new ArrayList<String>();
      runArgs.addAll(splitArgs(vmArgs));
      runArgs.addAll(splitArgs(pgmArgs));
      LaunchParameters launchParameters=target.createLaunchParameters();
      launchParameters.setArguments(runArgs);
      launchParameters.setWorkingDirectory(workingDir);
      launchParameters.setEnvironment(envToMap(envp));
      customizeLaunchParameters(launchParameters,configuration,mode);
      String label=String.format("%s (%s)",mainTypeName,DateFormat.getDateTimeInstance(DateFormat.MEDIUM,DateFormat.MEDIUM).format(new Date()));
      Process process=target.launch(launchParameters);
      if (launchParameters.getStdoutFifo() != null || launchParameters.getStderrFifo() != null) {
        InputStream stdoutStream=null;
        InputStream stderrStream=null;
        if (launchParameters.getStdoutFifo() != null) {
          stdoutStream=new OpenOnReadFileInputStream(launchParameters.getStdoutFifo());
        }
        if (launchParameters.getStderrFifo() != null) {
          stderrStream=new OpenOnReadFileInputStream(launchParameters.getStderrFifo());
        }
        process=new ProcessProxy(process,stdoutStream,stderrStream);
      }
      DebugPlugin.newProcess(launch,process,label);
      RoboVMPlugin.consoleInfo("Launch done");
      if (monitor.isCanceled()) {
        process.destroy();
        return;
      }
      monitor.worked(1);
    }
 catch (    IOException e) {
      RoboVMPlugin.consoleError("Launch failed");
      throw new CoreException(new Status(IStatus.ERROR,RoboVMPlugin.PLUGIN_ID,"Launch failed. Check the RoboVM console for more information.",e));
    }
  }
  finally {
    monitor.done();
  }
}
