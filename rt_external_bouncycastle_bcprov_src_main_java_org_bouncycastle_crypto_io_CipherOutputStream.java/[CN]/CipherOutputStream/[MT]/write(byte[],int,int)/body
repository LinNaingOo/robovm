{
  if (bufferedBlockCipher != null) {
    byte[] buf=new byte[bufferedBlockCipher.getOutputSize(len)];
    int outLen=bufferedBlockCipher.processBytes(b,off,len,buf,0);
    if (outLen != 0) {
      out.write(buf,0,outLen);
    }
  }
 else {
    byte[] buf=new byte[len];
    streamCipher.processBytes(b,off,len,buf,0);
    out.write(buf,0,len);
  }
}
