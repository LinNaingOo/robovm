{
  if (keySpec instanceof PBEKeySpec) {
    PBEKeySpec pbeSpec=(PBEKeySpec)keySpec;
    CipherParameters param;
    if (pbeSpec.getSalt() == null) {
      return new BCPBEKey(this.algName,this.algOid,scheme,digest,keySize,ivSize,pbeSpec,null);
    }
    if (forCipher) {
      param=PBE.Util.makePBEParameters(pbeSpec,scheme,digest,keySize,ivSize);
    }
 else {
      param=PBE.Util.makePBEMacParameters(pbeSpec,scheme,digest,keySize);
    }
    return new BCPBEKey(this.algName,this.algOid,scheme,digest,keySize,ivSize,pbeSpec,param);
  }
  throw new InvalidKeySpecException("Invalid KeySpec");
}
