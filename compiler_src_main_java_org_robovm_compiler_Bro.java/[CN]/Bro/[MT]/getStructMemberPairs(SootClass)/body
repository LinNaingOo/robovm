{
  int n=0;
  for (  SootMethod method : clazz.getMethods()) {
    n=Math.max(getStructMemberOffset(method) + 1,n);
  }
  if (n == 0) {
    return new StructMemberPair[0];
  }
  StructMemberPair[] result=new StructMemberPair[n];
  for (  SootMethod method : clazz.getMethods()) {
    int offset=getStructMemberOffset(method);
    if (offset != -1) {
      StructMemberPair pair=result[offset];
      if (pair == null) {
        pair=new StructMemberPair();
        result[offset]=pair;
      }
      if (pair.getter != null && pair.setter != null) {
        throw new IllegalArgumentException("Too many @StructMember " + "annotated methods with offset " + offset + " in class "+ clazz);
      }
      if (!method.isNative() && !method.isStatic()) {
        throw new IllegalArgumentException("@StructMember annotated method " + method.getName() + " in class "+ clazz+ " must be native and not static");
      }
      if (method.getParameterCount() == 0) {
        if (pair.getter != null) {
          throw new IllegalArgumentException("Two getters for " + "@StructMember(" + offset + ") found in class "+ clazz);
        }
        if (hasPointerAnnotation(method) && !method.getReturnType().equals(LongType.v())) {
          throw new IllegalArgumentException("@StructMember(" + offset + ") in class "+ clazz+ " must be of type long when annotated with @Pointer");
        }
        if (!canMarshal(method)) {
          throw new IllegalArgumentException("No @Marshaler found for " + "@StructMember(" + offset + ") in class "+ clazz);
        }
        validateStructMemberPair(method,pair.setter,clazz,offset);
        pair.getter=method;
      }
 else       if (method.getParameterCount() == 1) {
        if (pair.setter != null) {
          throw new IllegalArgumentException("Two setters for " + "@StructMember(" + offset + ") found in class "+ clazz);
        }
        if (hasPointerAnnotation(method,0) && !method.getParameterType(0).equals(LongType.v())) {
          throw new IllegalArgumentException("@StructMember(" + offset + ") in class "+ clazz+ " must be of type long when annotated with @Pointer");
        }
        if (!canMarshal(method,0)) {
          throw new IllegalArgumentException("No @Marshaler found for " + "@StructMember(" + offset + ") in class "+ clazz);
        }
        validateStructMemberPair(pair.getter,method,clazz,offset);
        soot.Type retType=method.getReturnType();
        if (!retType.equals(VoidType.v()) && !(retType instanceof RefType && ((RefType)retType).getSootClass().equals(clazz))) {
          throw new IllegalArgumentException("Setter " + method.getName() + " for "+ "@StructMember("+ offset+ ") in class "+ clazz+ " must either return nothing or return "+ clazz);
        }
        pair.setter=method;
      }
 else {
        throw new IllegalArgumentException("@StructMember annotated method " + method.getName() + " in class "+ clazz+ " has too many parameters");
      }
    }
  }
  for (int i=0; i < result.length; i++) {
    if (result[i] == null) {
      throw new IllegalArgumentException("No @StructMember(" + i + ") defined in class "+ clazz);
    }
  }
  return result;
}
