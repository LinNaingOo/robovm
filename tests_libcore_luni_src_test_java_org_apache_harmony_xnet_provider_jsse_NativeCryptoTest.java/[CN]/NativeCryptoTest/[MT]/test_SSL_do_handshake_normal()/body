{
  final ServerSocket listener=new ServerSocket(0);
  Hooks cHooks=new Hooks();
  Hooks sHooks=new ServerHooks(getServerPrivateKey(),getServerCertificates());
  Future<TestSSLHandshakeCallbacks> client=handshake(listener,0,true,cHooks,null);
  Future<TestSSLHandshakeCallbacks> server=handshake(listener,0,false,sHooks,null);
  TestSSLHandshakeCallbacks clientCallback=client.get(TIMEOUT_SECONDS,TimeUnit.SECONDS);
  TestSSLHandshakeCallbacks serverCallback=server.get(TIMEOUT_SECONDS,TimeUnit.SECONDS);
  assertTrue(clientCallback.verifyCertificateChainCalled);
  assertEqualCertificateChains(getServerCertificates(),clientCallback.asn1DerEncodedCertificateChain);
  assertEquals("RSA",clientCallback.authMethod);
  assertFalse(serverCallback.verifyCertificateChainCalled);
  assertFalse(clientCallback.clientCertificateRequestedCalled);
  assertFalse(serverCallback.clientCertificateRequestedCalled);
  assertTrue(clientCallback.handshakeCompletedCalled);
  assertTrue(serverCallback.handshakeCompletedCalled);
}
