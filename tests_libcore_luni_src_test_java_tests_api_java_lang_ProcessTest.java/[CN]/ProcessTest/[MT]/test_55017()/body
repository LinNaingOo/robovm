{
  ArrayList<Process> children=new ArrayList<Process>();
  for (int i=0; i < 256; ++i) {
    try {
      children.add(Runtime.getRuntime().exec(new String[]{"/system/bin/does-not-exist"},null,null));
      System.gc();
    }
 catch (    IOException expected) {
    }
  }
  assertEquals(0,children.size());
  boolean onDevice=new File("/system/bin").exists();
  String[] psCommand=onDevice ? new String[]{"ps"} : new String[]{"ps","s"};
  Process ps=Runtime.getRuntime().exec(psCommand,null,null);
  int zombieCount=0;
  for (  String line : readAndCloseStream(ps.getInputStream()).split("\n")) {
    if (line.contains(" Z ") || line.contains(" Z+ ")) {
      ++zombieCount;
    }
  }
  assertEquals(0,zombieCount);
}
