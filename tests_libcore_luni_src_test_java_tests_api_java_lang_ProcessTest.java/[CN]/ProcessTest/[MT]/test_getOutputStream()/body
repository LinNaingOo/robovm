{
  String[] commands={"cat","-"};
  Process p=Runtime.getRuntime().exec(commands,null,null);
  OutputStream os=p.getOutputStream();
  String str1="Some data for testing communication between processes\n";
  String str2="More data that serves the same purpose.\n";
  String str3="Here is some more data.\n";
  os.write(str1.getBytes());
  try {
    Thread.sleep(1000);
  }
 catch (  InterruptedException e) {
    e.printStackTrace();
  }
  os.write(str2.getBytes());
  os.write(str3.getBytes());
  os.close();
  String received=readAndCloseStream(p.getInputStream());
  assertEquals(str1 + str2 + str3,received);
  String stderr=readAndCloseStream(p.getErrorStream());
  assertEquals("",stderr);
  p.waitFor();
  p.destroy();
}
