{
  final String START_MARK="${{";
  final String END_MARK="}}";
  final int START_OFFSET=START_MARK.length();
  final int END_OFFSET=END_MARK.length();
  StringBuilder result=new StringBuilder(str);
  int start=result.indexOf(START_MARK);
  while (start >= 0) {
    int end=result.indexOf(END_MARK,start);
    if (end >= 0) {
      String key=result.substring(start + START_OFFSET,end);
      int separator=key.indexOf(':');
      String protocol=(separator >= 0) ? key.substring(0,separator) : key;
      String data=(separator >= 0) ? key.substring(separator + 1) : null;
      String value=handler.resolve(protocol,data);
      result.replace(start,end + END_OFFSET,value);
      start+=value.length();
    }
    start=result.indexOf(START_MARK,start);
  }
  return result.toString();
}
