{
  List<Object> args=new ArrayList<Object>();
  args.add("-f");
  args.add("-s");
  args.add(identity);
  if (entitlementsPList != null) {
    args.add("--entitlements");
    args.add(entitlementsPList);
  }
  args.add(appDir);
  @SuppressWarnings("unchecked") Map<String,String> env=new HashMap<String,String>(EnvironmentUtils.getProcEnvironment());
  env.put("CODESIGN_ALLOCATE",CompilerUtil.execCaptureOutput("xcrun","-sdk","iphoneos","-f","codesign_allocate").trim());
  CompilerUtil.execWithEnv(config,null,env,"codesign",args);
}
