{
  List<Type> types=new ArrayList<Type>();
  Map<String,Type> members=new HashMap<String,Type>();
  int index=0;
  for (  SootMethod method : clazz.getMethods()) {
    if (isStructMember(method)) {
      validateStructMember(method);
      String name=method.getName().substring(3,4).toLowerCase() + method.getName().substring(4);
      boolean getter=method.getName().startsWith("get");
      soot.Type sootType=getter ? method.getReturnType() : method.getParameterType(0);
      Type type=sootType instanceof PrimType ? getType(sootType) : I8_PTR;
      if (getter) {
        if (hasAnnotation(method,"Lorg/nullvm/rt/bro/annotation/Pointer;")) {
          if (!sootType.equals(LongType.v()) && !isStruct(sootType)) {
            throw new IllegalArgumentException("@StructMember annotated getter method " + method.getName() + " must return long or Struct when annotated with @Pointer");
          }
          type=I8_PTR;
        }
 else         if (hasAnnotation(method,"Lorg/nullvm/rt/bro/annotation/MachineWord;")) {
          if (!sootType.equals(LongType.v()) && !sootType.equals(DoubleType.v())) {
            throw new IllegalArgumentException("@StructMember annotated getter method " + method.getName() + " must return long or double when annotated with @MachineWord");
          }
          type=method.getReturnType().equals(LongType.v()) ? MACHINE_INT : MACHINE_FP;
        }
 else         if (isStruct(sootType)) {
          try {
            type=getStructType(sootType);
          }
 catch (          StackOverflowError e) {
            throw new IllegalArgumentException("Struct type " + sootType + " refers to itself");
          }
        }
      }
 else {
        if (hasParameterAnnotation(method,0,"Lorg/nullvm/rt/bro/annotation/Pointer;")) {
          if (!sootType.equals(LongType.v()) && !isStruct(sootType)) {
            throw new IllegalArgumentException("First parameter of @StructMember annotated setter method " + method.getName() + " must be of type long or Struct when annotated with @Pointer");
          }
          type=I8_PTR;
        }
 else         if (hasParameterAnnotation(method,0,"Lorg/nullvm/rt/bro/annotation/MachineWord;")) {
          if (!sootType.equals(LongType.v()) && !sootType.equals(DoubleType.v())) {
            throw new IllegalArgumentException("First parameter of @StructMember annotated setter method " + method.getName() + " must be of type long or double when annotated with @MachineWord");
          }
          type=method.getReturnType().equals(LongType.v()) ? MACHINE_INT : MACHINE_FP;
        }
 else         if (isStruct(sootType)) {
          try {
            type=getStructType(sootType);
          }
 catch (          StackOverflowError e) {
            throw new IllegalArgumentException("Struct type " + sootType + " refers to itself");
          }
        }
      }
      if (members.containsKey(name)) {
        if (!members.get(name).equals(type)) {
          throw new IllegalArgumentException("@StructMember annotated getter and setter methods for property " + name + " have different types");
        }
      }
 else {
        members.put(name,type);
        types.add(type);
        if (indexes != null) {
          indexes.put(name,index);
        }
        index++;
      }
    }
  }
  if (!types.isEmpty()) {
    return new StructureType(types.toArray(new Type[types.size()]));
  }
  return null;
}
