{
  CMSSignedData cms=new CMSSignedData(signedData);
  ASN1Set certSet=null;
  ASN1Set crlSet=null;
  if (certificates != null || attrCerts != null) {
    List certs=new ArrayList();
    if (certificates != null) {
      certs.addAll(CMSUtils.getCertificatesFromStore(certificates));
    }
    if (attrCerts != null) {
      certs.addAll(CMSUtils.getAttributeCertificatesFromStore(attrCerts));
    }
    ASN1Set set=CMSUtils.createBerSetFromList(certs);
    if (set.size() != 0) {
      certSet=set;
    }
  }
  if (crls != null) {
    ASN1Set set=CMSUtils.createBerSetFromList(CMSUtils.getCRLsFromStore(crls));
    if (set.size() != 0) {
      crlSet=set;
    }
  }
  cms.signedData=new SignedData(signedData.signedData.getDigestAlgorithms(),signedData.signedData.getEncapContentInfo(),certSet,crlSet,signedData.signedData.getSignerInfos());
  cms.contentInfo=new ContentInfo(cms.contentInfo.getContentType(),cms.signedData);
  return cms;
}
