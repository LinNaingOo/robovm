{
  int index1=0;
  int index2=fields.indexOf(ref.getField());
  if (index2 == fields.size() - 1) {
    index1=1;
    index2=0;
  }
  Variable baseI8Ptr=ctx.f().newVariable(I8_PTR);
  ctx.f().add(new Bitcast(baseI8Ptr,base,I8_PTR));
  Variable fieldI8Ptr=ctx.f().newVariable(I8_PTR);
  Value offset=new ConstantSub(new IntegerConstant(0),new ConstantPtrtoint(new ConstantGetelementptr(new NullConstant(new PointerType(fieldsType)),index1,index2),I32));
  ctx.f().add(new Getelementptr(fieldI8Ptr,new VariableRef(baseI8Ptr),offset));
  Variable fieldPtr=ctx.f().newVariable(new PointerType(getType(ref.getType())));
  ctx.f().add(new Bitcast(fieldPtr,new VariableRef(fieldI8Ptr),fieldPtr.getType()));
  return new VariableRef(fieldPtr);
}
