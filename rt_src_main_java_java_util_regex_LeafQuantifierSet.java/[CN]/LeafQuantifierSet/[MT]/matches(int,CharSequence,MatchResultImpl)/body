{
  int i=0;
  int shift=0;
  while (stringIndex + leaf.charCount() <= matchResult.getRightBound() && (shift=leaf.accepts(stringIndex,testString)) > 0) {
    stringIndex+=shift;
    i++;
  }
  for (; i >= 0; i--) {
    shift=next.matches(stringIndex,testString,matchResult);
    if (shift >= 0) {
      return shift;
    }
    stringIndex-=leaf.charCount();
  }
  return -1;
}
