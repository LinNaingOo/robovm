{
  if (!(key instanceof SecretKey)) {
    throw new InvalidKeyException("key must be a SecretKey");
  }
  if (params != null) {
    throw new InvalidAlgorithmParameterException("unknown parameter type");
  }
  if (key instanceof OpenSSLKeyHolder) {
    macKey=((OpenSSLKeyHolder)key).getOpenSSLKey();
  }
 else {
    final byte[] keyBytes=key.getEncoded();
    if (keyBytes == null) {
      throw new InvalidKeyException("key cannot be encoded");
    }
    macKey=new OpenSSLKey(NativeCrypto.EVP_PKEY_new_mac_key(evp_pkey_type,keyBytes));
  }
  NativeCrypto.EVP_MD_CTX_init(ctx.getContext());
  reset();
}
