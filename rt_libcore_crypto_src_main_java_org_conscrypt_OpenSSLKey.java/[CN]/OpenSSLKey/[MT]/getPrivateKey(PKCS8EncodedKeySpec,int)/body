{
  PKCS8EncodedKeySpec pkcs8KeySpec=(PKCS8EncodedKeySpec)keySpec;
  final OpenSSLKey key;
  try {
    key=new OpenSSLKey(NativeCrypto.d2i_PKCS8_PRIV_KEY_INFO(pkcs8KeySpec.getEncoded()));
  }
 catch (  Exception e) {
    throw new InvalidKeySpecException(e);
  }
  if (NativeCrypto.EVP_PKEY_type(key.getPkeyContext()) != type) {
    throw new InvalidKeySpecException("Unexpected key type");
  }
  try {
    return key.getPrivateKey();
  }
 catch (  NoSuchAlgorithmException e) {
    throw new InvalidKeySpecException(e);
  }
}
