{
  if (visitedBlocks.contains(block))   return;
  visitedBlocks.add(block);
  visitingSuccs.add(block);
  Iterator succsIt=block.getSuccs().iterator();
  while (succsIt.hasNext()) {
    Block succ=(Block)succsIt.next();
    if (visitedBlocks.contains(succ)) {
      if (succ != block && visitingSuccs.contains(succ)) {
        if (succ.getPreds().size() >= 2 && succ.getSuccs().size() == 2) {
          Block condition=succ;
          Block loopTailBlock=block;
          if (getSize(condition) <= maxSize) {
            Unit copiedHead=copyBlock(condition);
            Unit loopTail=loopTailBlock.getTail();
            if (loopTail instanceof GotoStmt)             ((GotoStmt)loopTail).setTarget(copiedHead);
 else             if (loopTail instanceof IfStmt) {
              if (((IfStmt)loopTail).getTarget() == condition.getHead())               ((IfStmt)loopTail).setTarget(copiedHead);
 else               insertGotoAfter(loopTail,copiedHead);
            }
 else             insertGotoAfter(loopTail,copiedHead);
          }
        }
      }
    }
 else {
      unrollConditions(succ);
    }
  }
  visitingSuccs.remove(block);
}
